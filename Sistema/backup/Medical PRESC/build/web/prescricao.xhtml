<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:decorate xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:p="http://primefaces.org/ui"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets" template="template.xhtml"
             xmlns:f="http://xmlns.jcp.org/jsf/core">

    <style type="text/css">
        .panelColumns .panelLinha  {
            text-align: center;
        }
        .tbl1 tr td {
            width: 240px; padding: 5px; border: 1px solid #aaa;
        }
        .tbl1 {
            margin: 0 auto;
        }
    </style>

    <h:form>

        <div style="padding: 5px; background: #ddd; border: 1px solid #aaa;">
            <p:toolbar>
                <f:facet name="left">
                    <p:commandButton id="btnNovoCont" style="background-color: cornflowerblue;" icon="fa fa-file-text-o" value="&nbsp;Novo registo" disabled="#{prescricaoBean.prescricao.novoRegisto == true}" action="#{prescricaoBean.novoRegistoX}" ajax="false" update="@form">
                        <f:ajax render="btnNovoCont" />
                        <f:ajax render="btnNovoContDown" />
                        <f:ajax render="btnCancelCont" />
                        <f:ajax render="btnCancelContDown" />
                        <f:ajax render="btnAdicionar" />
                        <f:ajax render="btnAdicionarDown" />

                    </p:commandButton>
                    <span class="ui-separator" style="text-align:center">
                        <span class="ui-icon-grip-dotted-vertical" />
                    </span>
                    <p:commandButton id="btnAdicionar" style="background-color: cornflowerblue;" icon="fa fa-save" ajax="false" value="&nbsp;Registar" disabled="#{prescricaoBean.prescricao.novoRegisto == false || prescricaoBean.prescricao.actualizarReg == true}"  update="@form">
                        <f:ajax render="btnNovoCont" />
                        <f:ajax render="btnNovoContDown" />
                        <f:ajax render="btnCancelCont" />
                        <f:ajax render="btnCancelContDown" />

                    </p:commandButton>
                    <span class="ui-separator">
                        <span class="ui-icon-grip-dotted-vertical" />
                    </span>
                    <p:commandButton id="btnCancelCont" style="background-color: indianred;" value="&nbsp;Cancelar" icon="fa fa-close" disabled="#{prescricaoBean.prescricao.novoRegisto == false}" action="#{prescricaoBean.cancelarRegistoX}" update="@form">
                        <f:ajax render="btnNovoCont" />
                        <f:ajax render="btnNovoContDown" />
                        <f:ajax render="btnCancelCont" />
                        <f:ajax render="btnCancelContDown" />
                        <f:ajax render="btnAdicionar" />
                        <f:ajax render="btnAdicionarDown" />

                    </p:commandButton>
                    <span class="ui-separator" style="text-align:center">
                        <span class="ui-icon-grip-dotted-vertical" />
                    </span>
                    <p:commandButton id="btnActualizar" style="background-color: cornflowerblue;" icon="fa fa-edit" ajax="false" value="&nbsp;Actualizar" disabled="#{prescricaoBean.prescricao.actualizarReg == false || prescricaoBean.prescricao.novoRegisto == false}" update="@form">
                        <f:ajax render="btnNovoCont" />
                        <f:ajax render="btnNovoContDown" />
                        <f:ajax render="btnCancelCont" />
                        <f:ajax render="btnCancelContDown" />

                    </p:commandButton>

                </f:facet>

            </p:toolbar>
            <hr/>
            <p:fieldset legend="Identificação do Paciente" style="background: #eee">

                <!-- <p:poll  interval="8" update="{usuarioBean.listar()}"/> -->

                <p:panelGrid class="panelForm" styleClass="panelColumns" style="margin: 0 auto;">

                    <p:row>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="pac" value="PAC:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="nome" value="Nome:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="apelido" value="Apelido:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="sexo" value="Sexo:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="contacto" value="Contacto:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="morada" value="Morada:"/>
                        </p:column>
                    </p:row>
                    <p:row class="panelLinha" style="background: #ddd">
                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu style="width: 185px" filter="true" filterMatchMode="startsWith" id="pac" value="#{prescricaoBean.prescricao.pac}">
                                <f:selectItems value="#{prescricaoBean.pacs}" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="nome" style="width: 185px" maxlength="25" disabled="true" value="#{prescricaoBean.prescricao.nome}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="apelido" style="width: 185px" maxlength="25" disabled="true"  value="#{prescricaoBean.prescricao.apelido}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="sexo" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.sexo}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="contacto" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.contacto}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="morada" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.morada}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>

                <br/>

                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton icon="fa fa-check" value="&nbsp;Confirmar" actionListener="#{prescricaoBean.confirmar(prescricaoBean.prescricao.pac, usuarioBean.usuario.confIdUsuario)}" ajax="true" update="@form"></p:commandButton>

                    </p:toolbarGroup>
                </p:toolbar>

                <br/>

            </p:fieldset>

            <br/>
            <p:fieldset legend="Prescrição" style="background: #eee">

                <p:panelGrid class="panelForm" styleClass="panelColumns" style="margin: 0 auto;">

                    <p:row>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="prescricao" value="Prescrição:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="posologia" value="Posologia:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="quantidade" value="Quantidade:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="data" value="Data:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="clinico" value="O Clínico:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="contClinico" value="Contacto (Clínico):"/>
                        </p:column>
                    </p:row>
                    <p:row class="panelLinha" style="background: #ddd">

                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu filter="true" style="width: 185px" filterMatchMode="startsWith" id="prescricao" value="#{medicamentoBean.medicamento.medicament}">
                                <f:selectItem itemLabel="Paracetamol (500MG) Comp"  itemValue="Paracetamol (500MG) Comp"/>
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu filter="true" style="width: 185px" filterMatchMode="startsWith" id="posologia" value="#{medicamentoBean.medicamento.posologia}">
                                <f:selectItem itemLabel="1 cp. 5/5h"  itemValue="1 cp. 5/5h"/>
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="quantidade" style="width: 185px" value="#{medicamentoBean.medicamento.quantidade}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="data" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.data}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="clinico" style="width: 185px" maxlength="30" disabled="true"  value="#{usuarioBean.usuario.confNome}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="contClinico" style="width: 185px" maxlength="30" disabled="true"  value="#{usuarioBean.usuario.confContacto}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <br/>

                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" action="#{prescricaoBean.adicionar(prescricaoBean.prescricao, medicamentoBean.medicamento)}" ajax="true" update="@form"></p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>

                <br/>

                <p:dataTable value="#{prescricaoBean.medicamentos}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{medicamento.idMedicamento}" rows="5" paginator="true" widgetVar="personTable" var="medicamento">
                    <p:column style="text-align: center" headerText="Operação" width="100">
                        <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{medicamentoBean.deletar(medicamento)}" update="@form"/>
                    </p:column>
                    <p:column headerText="Prescrição" sortBy="#{medicamento.medicament}">
                        <h:outputText value="#{medicamento.medicament}"></h:outputText>
                    </p:column>
                    <p:column headerText="Posologia" sortBy="#{medicamento.posologia}">
                        <h:outputText value="#{medicamento.posologia}"></h:outputText>
                    </p:column>
                    <p:column headerText="Quantidade" sortBy="#{medicamento.quantidade}">
                        <h:outputText value="#{medicamento.quantidade}"></h:outputText>
                    </p:column>
                </p:dataTable>

            </p:fieldset>

        </div>


        <br/>
        <p:growl id="messages" showDetail="true" sticky="true"/>

        <!--
        <p:poll  interval="1" timeout="2" update="{prescricaoBean.listar()}"/>
        -->

        <p:idleMonitor timeout="1200000">
            <p:ajax event="idle" listener="#{usuarioBean.reload()}" update="messages"/> 
        </p:idleMonitor>
    </h:form>
</ui:decorate>